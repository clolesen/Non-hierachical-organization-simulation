---
title: "Non-hierachical-organization-simulation"
author: "Christoffer Lundbak Olesen"
date: "3/19/2019"
output: html_document
---

This is the simulation code for the project named: "Can too many cooks spoil the broth? Boundary conditions to non-hierachical organization"


Loading libraries
```{r libraries}
library(tidyverse)
library(ggplot2)
```

FUNCTIONS
The variables in the functions and what they represent are:
nA = number of agents
nP = number of projects
nR = number of rounds
```{r Functions}

# CREATE NETWORK FUNCTION
# Function that returns a matrix as an edge list. Row number represents each agent and column 1 and 2 represent the neighbors of each agent. 
createNetwork = function(nA){
  
  #Create an empty matrix with 3 columns ans as many rows as number of agents
  agentNetwork = matrix(ncol = 2, nrow = nA)
  
  #Loop through all agents
  for (a in 1:nA){
    
    # If its the first agent, make an edge to the last and the second agent
    if (a == 1){
      edge1 = nA
      edge2 = 2
    }
    
    # If its the last agent, make an edge to the last-1 and the first agent
    if (a == nA){
      edge1 = a-1
      edge2 = 1
    }
    
    # If its any agent between 2 and the last-1, make an edge to the agents one lower and the agent one higher
    if(a %in% 2:(nA-1)){
      edge1 = a-1
      edge2 = a+1
    }
    
    # save the data into the matrix
    agentNetwork[a,1] = edge1
    agentNetwork[a,2] = edge2
  }
  
  return(agentNetwork)
}


# CREATE PROJECTS FUNCTION
# Function that returns a vector representing the number of tasks in each project
createProjects = function(nA, nP, nR){
  
  tasks = nA*nR/nP # formula for the number of tasks
  projectList = c(rep(tasks,nP)) # repeat the number of tasks nP times and make it into a vector
  projectList = round(projectList,2)
  return(projectList)
}


# CREATE AGENTS' EXPECTATIONS FUNCTION
# Function that returns a matrix with starting values of expectations. Each row is an agent and each column is a project.
createExpectations = function(nA, nP){
  
  # Prepare an empty matrix
  expMatrix = matrix(ncol = nP, nrow = nA) 
  
  # Loop through agents and loop through projects and insert a number on the agent,project place in the matrix
  for(a in 1:nA){
    for(p in 1:nP){
      expMatrix[a,p] = runif(1) # Random number between 0 and 1 drawn from a uniform distribution
      #expMatrix[a,p] = rnorm(1, 0.7, 0.1) # from normal distribution, Mean = 0.7, sd = 0.1
    }
  }
  return(expMatrix)
}


# SIMULATION FUNCTION
# Function that runs the simulation an returns a data frame.
simulation = function(nA, nP, nR, rewardExp, taskThresh, alpha, beta, sim = 1, customProjects = F){
  
  # Use other functions to set up the simulation
  network = createNetwork(nA)
  if (customProjects == F) {
    projects = createProjects(nA, nP, nR)
    sym = "symmetric" 
  }
  if (customProjects != F){
    projects = customProjects #Custom projects should be a vector with as many items as nP
    sym = "Asymmetric"
  }
  expectations = createExpectations(nA, nP)
  nTasks = mean(projects)
  startTasks = paste(projects, collapse = " - ")
  
  #prepare a list for storing the data of each round
  data_list = list()
  i = 1
  
  #Loop through each round
  for (round in 1:nR){
    
    #set up a vector for how many works on each project this round (same structure as the projects vector)
    work = c(rep(0,nP))
    
    # Empty vector for putting in the choices of the agents. (the structure will be: value n = choice of agent n)
    projectChoice = c()
    
    # CHOOSE PROJECT
    # Loop through agents
    for (a in 1:nA){
      
      # Find the project with the highest expectation
      proj =  which.max(expectations[a,])# which.max returns the placement of a number in a vector
      
      #add one to the project in "work" and store the choice in "projectChoice"
      work[proj] = work[proj] + 1
      projectChoice[a] = proj
    }
    
    # REWARDS
    # Calculate reward per project
    rewards = c(rep(0,nP)) # Empty vector for total rewards per project
    maxOpt = nA/nP # Maximum number of agentes working a project in order to get the optimal (1) reward per agent
    
    # loop through projects and calculate amount of total rewards based on the amount of agents working each project
    for (p in 1:nP){
      
      # if the number of agents working the project is less or equal to maxOpt, put this number on the total amount of reward for this project. Else, use the function to calculate it.
      if (work[p] <= maxOpt){ 
        rewards[p] = work[p]
      } else {
        # Function for calculating total amount of rewards.
        # rewardExp is the exponent defined outside the simulation.
        # (work[p]-maxOpt+1) is just the number of agents above maxOpt + 1 (to make the exponent work from the first agent above maxOpt)
        # the minus 1 in the end is add to shift it down to the intercept
        rewards[p] = maxOpt + (work[p]-maxOpt+1)^rewardExp-1 
      }
      
      #if the number of tasks left is lower than a percentage (defined outside the simulation) of the max amount of tasks, then calculate a modifier and apply it to the total amount of rewards.
      if (projects[p] < nTasks*taskThresh){
        percentageLeft = projects[p] / nTasks # How much work is left
        modifier = percentageLeft/taskThresh # percentage left since the threshold as a modifier
        rewards[p] = rewards[p] * modifier # Apply the modifier
      }
    }
    
    #calculate reward per agent
    # for each agent, divide the total number of reward on the chosen project and divide it with the amount of agents who worked that project and store it as this agents reward in a vector.
    agentReward = c() 
    for (a in 1:nA){
      p = projectChoice[a]
      agentReward[a] = rewards[p]/work[p]
    }
    
    #UPDATE EXPECTAIONS
    # new exp = alpha * reward + (1 - alpha) * exp
    # loop through agents and calculate new expextation for the project they chose and replace it with the old one
    for (a in 1:nA){
      p = projectChoice[a] 
      newExp = alpha * agentReward[a] + (1-alpha) * expectations[a,p]
      expectations[a,p] = newExp
    }
    
    # Loop through agents and check if the naighbors (egdes in the network) chose a different project. If they did update this project as well using the method above (but with beta instead of alpha)
    for (a in 1:nA){
      n1 = network[a,1]
      n2 = network[a,2]
      
      if (projectChoice[a] != projectChoice[n1]){
        p = projectChoice[n1] 
        newExp = beta * agentReward[n1] + (1-beta) * expectations[a,p]
        expectations[a,p] = newExp
      }
      
      if (projectChoice[a] != projectChoice[n2]){
        p = projectChoice[n2] 
        newExp = beta * agentReward[n2] + (1-beta) * expectations[a,p]
        expectations[a,p] = newExp
      }
    }
    
    #update projects 
    projects = projects - rewards # just subtracts the amount of rewards on each project with the amount of work left on each project.
    for (p in projects){
      if (p < 0){
        projects[p] = 0
      }
    }
    
    
    #SAVE THE DATA
    # the reason it takes this much code to save the data is that it should be flexible with number of columns in the final data frame as it changes with the number of projects.
    eNames = c()
    pNames = c()
    rNames = c()
    wNames = c()
    for (p in 1:nP){
      eNames = c(eNames, paste("Expectation", p, sep = ""))
      pNames = c(pNames, paste("Project", p,"_Tasks", sep = ""))
      rNames = c(rNames, paste("Project", p, "_Rewards", sep = ""))
      wNames = c(wNames, paste("Project", p, "_Work", sep = ""))
    }
    
    temp_data = as.data.frame(matrix(nrow = nA, ncol = nP*4+12))
    colnames(temp_data) = c(
      "Simulation",
      "Round",
      "Agent",
      "Choice",
      "Reward",
      eNames,
      pNames,rNames,wNames,
      "symmetry",
      "alpha",
      "beta",
      "nAgents",
      "nProjects",
      "startTasks",
      "nRounds"
    )
    
    temp_data[,1] = sim
    temp_data[,2] = round
    temp_data[,3] = 1:nA
    temp_data[,4] = projectChoice
    temp_data[,5] = agentReward
    
    for (p in 1:nP){
      e = paste("Expectation", p, sep = "")
      pr = paste("Project", p,"_Tasks", sep = "")
      r = paste("Project", p, "_Rewards", sep = "")
      w = paste("Project", p, "_Work", sep = "")
      
      temp_data[e] = expectations[,p]
      temp_data[pr] = projects[p]
      temp_data[r] = rewards[p]
      temp_data[w] = work[p]
    }
    
    n = ncol(temp_data)
    temp_data[,n-6] = sym
    temp_data[,n-5] = alpha
    temp_data[,n-4] = beta
    temp_data[,n-3] = nA
    temp_data[,n-2] = nP
    temp_data[,n-1] = startTasks
    temp_data[,n] = nR
    
    #saving this rounds data into a list of data frames
    data_list[[i]] = temp_data
    i = i + 1
    
    
  } # End of the round loop
  
  # combine all the data frames in the data_list into one 
  data = do.call(rbind, data_list)
  
  return(data)
  
}

# Function that greates custom project list for either 3 or 6 projects.
getAsymProj = function(nA,nP,nR){
  
  if (nP == 3){
    p = list(
      c(
        (nA*nR/3)*0.5,
        (nA*nR/3),
        (nA*nR/3)*1.5
      ),
      c(
        (nA*nR/3)*0.2,
        (nA*nR/3),
        (nA*nR/3)*1.8
      )
    )
  }
  
  if (nP == 6){
    p = list(
      c(
        (nA*nR/6)*0.6,
        (nA*nR/6)*0.6,
        (nA*nR/6),
        (nA*nR/6),
        (nA*nR/6)*1.4,
        (nA*nR/6)*1.4
      ),
      c(
        (nA*nR/6)*0.3,
        (nA*nR/6)*0.6,
        (nA*nR/6)*0.9,
        (nA*nR/6)*1.1,
        (nA*nR/6)*1.4,
        (nA*nR/6)*1.7
      )
    )
  }
  p[[1]] = round(p[[1]],2)
  p[[2]] = round(p[[2]],2)
  return(p)
}
```

Variables that can be changed before running the simulation
```{r Variable options}
nRounds = 50
#nAgents = 18
#nProjects = 6
rewardExp = 0.5
taskThresh = 0.4
alpha = 0.5
beta = 0.3
```

Running the simulation fuction in loops with varying variables
```{r Run simulation}

# Number of agents to loop through
agents = c(18,40,60,90,120)

# loop through different numbers of agents and 3 projects
data_list = list()
i = 1
for (a in agents) {
  set.seed(61)
  for (s in 1:9){
    data_list[[i]] = simulation(a, 3, nRounds, rewardExp, taskThresh, alpha, beta, s)
    i = i + 1
  }
  
  customProjList = getAsymProj(a,3,nRounds)
  for (cp in customProjList){
    set.seed(61)
    for (s in 1:3){
      data_list[[i]] = simulation(a, 3, nRounds, rewardExp, taskThresh, alpha, beta, s, cp)
      i = i + 1
    }
  }
}
data3pAll = do.call(rbind, data_list)

# loop through different numbers of agents and 6 projects
data_list = list()
i = 1
for (a in agents) {
  set.seed(61)
  for (s in 1:9){
    data_list[[i]] = simulation(a, 6, nRounds, rewardExp, taskThresh, alpha, beta, s)
    i = i + 1
  }
  
  customProjList = getAsymProj(a,6,nRounds)
  for (cp in customProjList){
    set.seed(61)
    for (s in 1:3){
      data_list[[i]] = simulation(a, 6, nRounds, rewardExp, taskThresh, alpha, beta, s, cp)
      i = i + 1
    }
  }
}
data6pAll = do.call(rbind, data_list)



# Check Exponent and trheshold
data_list = list()
i = 1
for (e in c(0,0.3,0.5,0.7)){
  for (t in c(0.2, 0.4, 0.7)){
    set.seed(61)
    d = simulation(nAgents, nProjects, nRounds, e, t, alpha, beta)
    d$exp = e
    d$thresh = t
    data_list[[i]] = d
    i = i + 1
  }
}
e_t_data = do.call(rbind, data_list)



# ALPHA SIM 
data_list = list()
i = 1
set.seed(61)
for (s in 1:100){
  for (a in c(.1,.2,.3,.4,.5,.6,.7,.8,.9)){
    d = simulation(nAgents, nProjects, nRounds, rewardExp, taskThresh, a, beta, s)
    data_list[[i]] = d
    i = i + 1
  }
  print(s)}
alphaSim = do.call(rbind, data_list)
```

PLOTS
```{r PLOTS}
#Alpha ~ Beta plot
#ggplot(data, aes(y = as.factor(Agent), x = Round)) +
#  geom_point(aes(color = as.factor(Choice)), shape = 15, size = 3) +
#  facet_wrap(alpha~beta) +
#  theme_minimal()


#PLOT function
simPlots = function(data,projects,sym=T){
  
  if (projects == 3) {
    if (sym == T){
    # Project development over time
    plot1 = ggplot(data, aes(x = Round))+
      geom_line(aes(y = Project1_Tasks), color = 1) +
      geom_line(aes(y = Project2_Tasks), color = 2) +
      geom_line(aes(y = Project3_Tasks), color = 3) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Tasks left each round",subtitle = "Projects seperated by color", y = "Tasks")
    
    
    plot2 = ggplot(data, aes(x = Round))+
      geom_line(aes(y = Project1_Work), color = 1) +
      geom_line(aes(y = Project2_Work), color = 2) +
      geom_line(aes(y = Project3_Work), color = 3) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Number of tasks done each round", subtitle = "Projects seperated by color", y = "Tasks")
    
    # Reward plots
    plot3 = ggplot(data, aes(x = Round, y = Reward))+
      geom_line(aes(color = as.character(Agent))) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Reward given each round", subtitle = "Agents seperated by color", color = "Agent")
    
    
    plot4 = ggplot(data, aes(x = Round, y = Reward))+
      stat_summary(fun.y=min, geom="line") +
      stat_summary(fun.y=max, geom="line") +
      stat_summary(fun.y=mean, geom="line", color = "red") +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Reward given each round", subtitle = "Red represents the mean and black the minimum and maximum reward")
    
    
    # Reward - Expectation plots
    plot5 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
      geom_point(aes(y = Project1_Rewards/Project1_Work), size = .4) +
      geom_line(aes(y = Expectation1, color = as.character(Agent))) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Agent 1 & 9, Reward and Expectation for project 1", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")
    
    
    plot6 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
      geom_point(aes(y = Project2_Rewards/Project2_Work), size = .4) +
      geom_line(aes(y = Expectation2, color = as.character(Agent))) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Agent 1 & 9, Reward and Expectation for project 2", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")
    
    
    plot7 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
      geom_point(aes(y = Project3_Rewards/Project3_Work), size = .4) +
      geom_line(aes(y = Expectation3, color = as.character(Agent))) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Agent 1 & 9, Reward and Expectation for project 3", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")
    
    # total reward plot
    plot8 = ggplot(data, aes(y = Reward, x = Agent)) +
      stat_summary(fun.y = "sum", geom = "bar") + 
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Bar plot of the total sum of rewards per agent", subtitle = "Across 9 different simulations of 50 rounds each", y = "Sum of rewards")
    
    
    
    plot9 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round, y = as.factor(Choice))) +
      geom_point(aes(color = as.factor(Agent))) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Agent 1 and 9 project choice", subtitle = "Across 9 different simulations of 50 rounds each", y = "Projects", color = "Agent")
    
    
    plot10 = ggplot(data, aes(x = Round, y = as.factor(Agent))) +
      geom_point(aes(color = as.factor(Choice)), shape = 15, size = 2.5) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Project choice for all agents", subtitle = "Projects represented by color", y = "Actors", color = "Projects")
    
    } #End sym plots
    
    if (sym == F){
      # Project development over time
plot1 = ggplot(data, aes(x = Round))+
  geom_line(aes(y = Project1_Tasks), color = 1) +
  geom_line(aes(y = Project2_Tasks), color = 2) +
  geom_line(aes(y = Project3_Tasks), color = 3) +
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Tasks left each round",subtitle = "Projects seperated by color", y = "Tasks")


plot2 = ggplot(data, aes(x = Round))+
  geom_line(aes(y = Project1_Work), color = 1) +
  geom_line(aes(y = Project2_Work), color = 2) +
  geom_line(aes(y = Project3_Work), color = 3) +
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Number of tasks done each round", subtitle = "Projects seperated by color", y = "Tasks")

# Reward plots
plot3 = ggplot(data, aes(x = Round, y = Reward))+
  geom_line(aes(color = as.character(Agent))) +
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Reward given each round", subtitle = "Agents seperated by color", color = "Agent")


plot4 = ggplot(data, aes(x = Round, y = Reward))+
  stat_summary(fun.y=min, geom="line") +
  stat_summary(fun.y=max, geom="line") +
  stat_summary(fun.y=mean, geom="line", color = "red") +
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Reward given each round", subtitle = "Red represents the mean and black the minimum and maximum reward")


# Reward - Expectation plots
plot5 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
  geom_point(aes(y = Project1_Rewards/Project1_Work), size = .4) +
  geom_line(aes(y = Expectation1, color = as.character(Agent))) +
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Agent 1 & 9, Reward and Expectation for project 1", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")


plot6 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
  geom_point(aes(y = Project2_Rewards/Project2_Work), size = .4) +
  geom_line(aes(y = Expectation2, color = as.character(Agent))) +
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Agent 1 & 9, Reward and Expectation for project 2", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")


plot7 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
  geom_point(aes(y = Project3_Rewards/Project3_Work), size = .4) +
  geom_line(aes(y = Expectation3, color = as.character(Agent))) +
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Agent 1 & 9, Reward and Expectation for project 3", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")

# total reward plot
plot8 = ggplot(data, aes(y = Reward, x = Agent)) +
  stat_summary(fun.y = "sum", geom = "bar") + 
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Bar plot of the total sum of rewards per agent", subtitle = "Across 6 different simulations of 50 rounds each", y = "Sum of rewards")

#Project Choice plots
plot9 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round, y = as.factor(Choice))) +
  geom_point(aes(color = as.factor(Agent))) +
  facet_wrap(cp~Simulation) +
  theme_minimal() +
  labs(title = "Agent 1 and 9 project choice", subtitle = "Across 9 different simulations of 50 rounds each", y = "Projects", color = "Agent")


plot10 = ggplot(data, aes(x = Round, y = as.factor(Agent))) +
  geom_point(aes(color = as.factor(Choice)), shape = 15, size = 3.7) +
  facet_wrap(cp~Simulation) +
  theme_minimal() +
  labs(title = "Project choice for all agents", subtitle = "Projects represented by color", y = "Actors", color = "Projects")
    } # End of asymmetry plots
    
    return(
      list(
        plot1,
        plot2,
        plot3,
        plot4,
        plot5,
        plot6,
        plot7,
        plot8,
        plot9,
        plot10
      )
    )
    
  } # end 3 projects
  
  
  if (projects == 6){
    if (sym == T){
    #### 6 projects ####
    
    # Project development over time
    plot1 = ggplot(data, aes(x = Round))+
      geom_line(aes(y = Project1_Tasks), color = 1) +
      geom_line(aes(y = Project2_Tasks), color = 2) +
      geom_line(aes(y = Project3_Tasks), color = 3) +
      geom_line(aes(y = Project4_Tasks), color = 4) +
      geom_line(aes(y = Project5_Tasks), color = 5) +
      geom_line(aes(y = Project6_Tasks), color = 6) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Tasks left each round",subtitle = "Projects seperated by color", y = "Tasks")
    
    
    plot2 = ggplot(data, aes(x = Round))+
      geom_line(aes(y = Project1_Work), color = 1) +
      geom_line(aes(y = Project2_Work), color = 2) +
      geom_line(aes(y = Project3_Work), color = 3) +
      geom_line(aes(y = Project4_Work), color = 4) +
      geom_line(aes(y = Project5_Work), color = 5) +
      geom_line(aes(y = Project6_Work), color = 6) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Number of tasks done each round", subtitle = "Projects seperated by color", y = "Tasks")
    
    # Reward plots
    plot3 = ggplot(data, aes(x = Round, y = Reward))+
      geom_line(aes(color = as.character(Agent))) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Reward given each round", subtitle = "Agents seperated by color", color = "Agent")
    
    
    plot4 = ggplot(data, aes(x = Round, y = Reward))+
      stat_summary(fun.y=min, geom="line") +
      stat_summary(fun.y=max, geom="line") +
      stat_summary(fun.y=mean, geom="line", color = "red") +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Reward given each round", subtitle = "Red represents the mean and black the minimum and maximum reward")
    
    
    # Reward - Expectation plots
    plot5 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
      geom_point(aes(y = Project1_Rewards/Project1_Work), size = .4) +
      geom_line(aes(y = Expectation1, color = as.character(Agent))) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Agent 1 & 9, Reward and Expectation for project 1", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")
    
    
    plot6 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
      geom_point(aes(y = Project2_Rewards/Project2_Work), size = .4) +
      geom_line(aes(y = Expectation2, color = as.character(Agent))) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Agent 1 & 9, Reward and Expectation for project 2", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")
    
    
    plot7 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
      geom_point(aes(y = Project3_Rewards/Project3_Work), size = .4) +
      geom_line(aes(y = Expectation3, color = as.character(Agent))) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Agent 1 & 9, Reward and Expectation for project 3", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")
    
    # Reward - Expectation plots
    plot8 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
      geom_point(aes(y = Project4_Rewards/Project4_Work), size = .4) +
      geom_line(aes(y = Expectation4, color = as.character(Agent))) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Agent 1 & 9, Reward and Expectation for project 4", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")
    
    
    plot9 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
      geom_point(aes(y = Project5_Rewards/Project5_Work), size = .4) +
      geom_line(aes(y = Expectation5, color = as.character(Agent))) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Agent 1 & 9, Reward and Expectation for project 5", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")
    
    
    plot10 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
      geom_point(aes(y = Project6_Rewards/Project6_Work), size = .4) +
      geom_line(aes(y = Expectation6, color = as.character(Agent))) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Agent 1 & 9, Reward and Expectation for project 6", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")
    
    # total reward plot
    plot11 = ggplot(data, aes(y = Reward, x = Agent)) +
      stat_summary(fun.y = "sum", geom = "bar") + 
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Bar plot of the total sum of rewards per agent", subtitle = "Across 9 different simulations of 50 rounds each", y = "Sum of rewards")
    
    
    #Project Choice plots
    plot12 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round, y = as.factor(Choice))) +
      geom_point(aes(color = as.factor(Agent))) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Agent 1 and 9 project choice", subtitle = "Across 9 different simulations of 50 rounds each", y = "Projects", color = "Agent")
    
    
    plot13 = ggplot(data, aes(x = Round, y = as.factor(Agent))) +
      geom_point(aes(color = as.factor(Choice)), shape = 15, size = 2.5) +
      facet_wrap(~Simulation) +
      theme_minimal() +
      labs(title = "Project choice for all agents", subtitle = "Projects represented by color", y = "Actors", color = "Projects")
    
    } # End of symmetry plots
    
    if (sym == F){
  plot1 = ggplot(data, aes(x = Round))+
  geom_line(aes(y = Project1_Tasks), color = 1) +
  geom_line(aes(y = Project2_Tasks), color = 2) +
  geom_line(aes(y = Project3_Tasks), color = 3) +
  geom_line(aes(y = Project4_Tasks), color = 4) +
  geom_line(aes(y = Project5_Tasks), color = 5) +
  geom_line(aes(y = Project6_Tasks), color = 6) +
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Tasks left each round",subtitle = "Projects seperated by color", y = "Tasks")


plot2 = ggplot(data, aes(x = Round))+
  geom_line(aes(y = Project1_Work), color = 1) +
  geom_line(aes(y = Project2_Work), color = 2) +
  geom_line(aes(y = Project3_Work), color = 3) +
  geom_line(aes(y = Project4_Work), color = 4) +
  geom_line(aes(y = Project5_Work), color = 5) +
  geom_line(aes(y = Project6_Work), color = 6) +
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Number of tasks done each round", subtitle = "Projects seperated by color", y = "Tasks")

# Reward plots
plot3 = ggplot(data, aes(x = Round, y = Reward))+
  geom_line(aes(color = as.character(Agent))) +
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Reward given each round", subtitle = "Agents seperated by color", color = "Agent")


plot4 = ggplot(data, aes(x = Round, y = Reward))+
  stat_summary(fun.y=min, geom="line") +
  stat_summary(fun.y=max, geom="line") +
  stat_summary(fun.y=mean, geom="line", color = "red") +
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Reward given each round", subtitle = "Red represents the mean and black the minimum and maximum reward")


# Reward - Expectation plots
plot5 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
  geom_point(aes(y = Project1_Rewards/Project1_Work), size = .4) +
  geom_line(aes(y = Expectation1, color = as.character(Agent))) +
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Agent 1 & 9, Reward and Expectation for project 1", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")


plot6 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
  geom_point(aes(y = Project2_Rewards/Project2_Work), size = .4) +
  geom_line(aes(y = Expectation2, color = as.character(Agent))) +
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Agent 1 & 9, Reward and Expectation for project 2", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")


plot7 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
  geom_point(aes(y = Project3_Rewards/Project3_Work), size = .4) +
  geom_line(aes(y = Expectation3, color = as.character(Agent))) +
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Agent 1 & 9, Reward and Expectation for project 3", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")

plot8 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
  geom_point(aes(y = Project4_Rewards/Project4_Work), size = .4) +
  geom_line(aes(y = Expectation4, color = as.character(Agent))) +
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Agent 1 & 9, Reward and Expectation for project 4", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")


plot9 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
  geom_point(aes(y = Project5_Rewards/Project5_Work), size = .4) +
  geom_line(aes(y = Expectation5, color = as.character(Agent))) +
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Agent 1 & 9, Reward and Expectation for project 5", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")


plot10 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round)) +
  geom_point(aes(y = Project6_Rewards/Project6_Work), size = .4) +
  geom_line(aes(y = Expectation6, color = as.character(Agent))) +
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Agent 1 & 9, Reward and Expectation for project 6", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round", y = "Reward - Expectation", color = "Agent")

# total reward plot
plot11 = ggplot(data, aes(y = Reward, x = Agent)) +
  stat_summary(fun.y = "sum", geom = "bar") + 
  facet_wrap(cp~Simulation, ncol = 3) +
  theme_minimal() +
  labs(title = "Bar plot of the total sum of rewards per agent", subtitle = "Across 6 different simulations of 50 rounds each", y = "Sum of rewards")


#Project Choice plots
plot12 = ggplot(subset(data, Agent %in% c(1,9)), aes(x = Round, y = as.factor(Choice))) +
  geom_point(aes(color = as.factor(Agent))) +
  facet_wrap(cp~Simulation) +
  theme_minimal() +
  labs(title = "Agent 1 and 9 project choice", subtitle = "Across 9 different simulations of 50 rounds each", y = "Projects", color = "Agent")


plot13 = ggplot(data, aes(x = Round, y = as.factor(Agent))) +
  geom_point(aes(color = as.factor(Choice)), shape = 15, size = 3.7) +
  facet_wrap(cp~Simulation) +
  theme_minimal() +
  labs(title = "Project choice for all agents", subtitle = "Projects represented by color", y = "Actors", color = "Projects")
    } # End of asymmetry plots
    
    return(
      list(
        plot1,
        plot2,
        plot3,
        plot4,
        plot5,
        plot6,
        plot7,
        plot8,
        plot9,
        plot10,
        plot11,
        plot12,
        plot13
      )
    )
  } #End of 6 projects
  
}

plots18a3p = simPlots(data18a3p,3)
plots18a6p = simPlots(data18a6p,6)
plots18a3p_asym = simPlots(asym_data18a3p,3, sym = F)
plots18a6p_asym = simPlots(asym_data18a6p,6, sym = F)

simPlots(subset(data3pAll, nAgents == 120 & symmetry == "symmetric"),3)[[3]]

ggsave("plots/18_agents/3_projects/Symetric-projects-plots/Tasks-left_plot.png", plots18a3p[[1]])
ggsave("plots/18_agents/3_projects/Symetric-projects-plots/Tasks-done_plot.png", plots18a3p[[2]])
ggsave("plots/18_agents/3_projects/Symetric-projects-plots/Reward-given_agents_plot.png", plots18a3p[[3]])
ggsave("plots/18_agents/3_projects/Symetric-projects-plots/Rewards-given_summary_plot.png", plots18a3p[[4]])
ggsave("plots/18_agents/3_projects/Symetric-projects-plots/Agent1and9_project1_plot.png", plots18a3p[[5]])
ggsave("plots/18_agents/3_projects/Symetric-projects-plots/Agent1and9_project2_plot.png", plots18a3p[[6]])
ggsave("plots/18_agents/3_projects/Symetric-projects-plots/Agent1and9_project3_plot.png", plots18a3p[[7]])
ggsave("plots/18_agents/3_projects/Symetric-projects-plots/Sum-rewards_plot.png", plots18a3p[[8]])
ggsave("plots/18_agents/3_projects/Symetric-projects-plots/Agent1and9_choice_plot.png", plots18a3p[[9]])
ggsave("plots/18_agents/3_projects/Symetric-projects-plots/Project_choice_plot.png", plots18a3p[[10]])

ggsave("plots/18_agents/3_projects/Asymetric-projects-plots/Tasks-left_plot.png", plots18a3p_asym[[1]])
ggsave("plots/18_agents/3_projects/Asymetric-projects-plots/Tasks-done_plot.png", plots18a3p_asym[[2]])
ggsave("plots/18_agents/3_projects/Asymetric-projects-plots/Reward-given_agents_plot.png", plots18a3p_asym[[3]])
ggsave("plots/18_agents/3_projects/Asymetric-projects-plots/Rewards-given_summary_plot.png", plots18a3p_asym[[4]])
ggsave("plots/18_agents/3_projects/Asymetric-projects-plots/Agent1and9_project1_plot.png", plots18a3p_asym[[5]])
ggsave("plots/18_agents/3_projects/Asymetric-projects-plots/Agent1and9_project2_plot.png", plots18a3p_asym[[6]])
ggsave("plots/18_agents/3_projects/Asymetric-projects-plots/Agent1and9_project3_plot.png", plots18a3p_asym[[7]])
ggsave("plots/18_agents/3_projects/Asymetric-projects-plots/Sum-rewards_plot.png", plots18a3p_asym[[8]])
ggsave("plots/18_agents/3_projects/Asymetric-projects-plots/Agent1and9_choice_plot.png", plots18a3p_asym[[9]])
ggsave("plots/18_agents/3_projects/Asymetric-projects-plots/Project_choice_plot.png", plots18a3p_asym[[10]])


ggsave("plots/18_agents/6_projects/Symetric-projects-plots/Tasks-left_plot.png", plots18a6p[[1]])
ggsave("plots/18_agents/6_projects/Symetric-projects-plots/Tasks-done_plot.png", plots18a6p[[2]])
ggsave("plots/18_agents/6_projects/Symetric-projects-plots/Reward-given_agents_plot.png", plots18a6p[[3]])
ggsave("plots/18_agents/6_projects/Symetric-projects-plots/Rewards-given_summary_plot.png", plots18a6p[[4]])
ggsave("plots/18_agents/6_projects/Symetric-projects-plots/Agent1and9_project1_plot.png", plots18a6p[[5]])
ggsave("plots/18_agents/6_projects/Symetric-projects-plots/Agent1and9_project2_plot.png", plots18a6p[[6]])
ggsave("plots/18_agents/6_projects/Symetric-projects-plots/Agent1and9_project3_plot.png", plots18a6p[[7]])
ggsave("plots/18_agents/6_projects/Symetric-projects-plots/Agent1and9_project4_plot.png", plots18a6p[[8]])
ggsave("plots/18_agents/6_projects/Symetric-projects-plots/Agent1and9_project5_plot.png", plots18a6p[[9]])
ggsave("plots/18_agents/6_projects/Symetric-projects-plots/Agent1and9_project6_plot.png", plots18a6p[[10]])
ggsave("plots/18_agents/6_projects/Symetric-projects-plots/Sum-rewards_plot.png", plots18a6p[[11]])
ggsave("plots/18_agents/6_projects/Symetric-projects-plots/Agent1and9_choice_plot.png", plots18a6p[[12]])
ggsave("plots/18_agents/6_projects/Symetric-projects-plots/Project_choice_plot.png", plots18a6p[[13]])



ggsave("plots/18_agents/6_projects/Asymetric-projects-plots/Tasks-left_plot.png", plots18a6p_asym[[1]])
ggsave("plots/18_agents/6_projects/Asymetric-projects-plots/Tasks-done_plot.png", plots18a6p_asym[[2]])
ggsave("plots/18_agents/6_projects/Asymetric-projects-plots/Reward-given_agents_plot.png", plots18a6p_asym[[3]])
ggsave("plots/18_agents/6_projects/Asymetric-projects-plots/Rewards-given_summary_plot.png", plots18a6p_asym[[4]])
ggsave("plots/18_agents/6_projects/Asymetric-projects-plots/Agent1and9_project1_plot.png", plots18a6p_asym[[5]])
ggsave("plots/18_agents/6_projects/Asymetric-projects-plots/Agent1and9_project2_plot.png", plots18a6p_asym[[6]])
ggsave("plots/18_agents/6_projects/Asymetric-projects-plots/Agent1and9_project3_plot.png", plots18a6p_asym[[7]])
ggsave("plots/18_agents/6_projects/Asymetric-projects-plots/Agent1and9_project4_plot.png", plots18a6p_asym[[8]])
ggsave("plots/18_agents/6_projects/Asymetric-projects-plots/Agent1and9_project5_plot.png", plots18a6p_asym[[9]])
ggsave("plots/18_agents/6_projects/Asymetric-projects-plots/Agent1and9_project6_plot.png", plots18a6p_asym[[10]])
ggsave("plots/18_agents/6_projects/Asymetric-projects-plots/Sum-rewards_plot.png", plots18a6p_asym[[11]])
ggsave("plots/18_agents/6_projects/Asymetric-projects-plots/Agent1and9_choice_plot.png", plots18a6p_asym[[12]])
ggsave("plots/18_agents/6_projects/Asymetric-projects-plots/Project_choice_plot.png", plots18a6p_asym[[13]])

###____###
########### Exponent and Threshold plots ######
# Project development over time
ggplot(e_t_data, aes(x = Round))+
  geom_line(aes(y = Project1_Tasks), color = 1) +
  geom_line(aes(y = Project2_Tasks), color = 2) +
  geom_line(aes(y = Project3_Tasks), color = 3) +
  facet_wrap(exp~thresh, ncol = 3) +
  theme_minimal() +
  labs(title = "Tasks left each round",subtitle = "Projects seperated by color \nValues above plots: Upper = Eksponent, Lower = Threshold", y = "Tasks")


ggplot(e_t_data, aes(x = Round))+
  geom_line(aes(y = Project1_Work), color = 1) +
  geom_line(aes(y = Project2_Work), color = 2) +
  geom_line(aes(y = Project3_Work), color = 3) +
  facet_wrap(exp~thresh, ncol = 3) +
  theme_minimal() +
  labs(title = "Number of tasks done each round", subtitle = "Projects seperated by color\nValues above plots: Upper = Eksponent, Lower = Threshold", y = "Tasks")

# Reward plots
ggplot(e_t_data, aes(x = Round, y = Reward))+
  geom_line(aes(color = as.character(Agent))) +
  facet_wrap(exp~thresh, ncol = 3) +
  theme_minimal() +
  labs(title = "Reward given each round", subtitle = "Agents seperated by color\nValues above plots: Upper = Eksponent, Lower = Threshold", color = "Agent")


ggplot(e_t_data, aes(x = Round, y = Reward))+
  stat_summary(fun.y=min, geom="line") +
  stat_summary(fun.y=max, geom="line") +
  stat_summary(fun.y=mean, geom="line", color = "red") +
  facet_wrap(exp~thresh, ncol = 3) +
  theme_minimal() +
  labs(title = "Reward given each round", subtitle = "Red represents the mean and black the minimum and maximum reward\nValues above plots: Upper = Eksponent, Lower = Threshold")


# Reward - Expectation plots
ggplot(subset(e_t_data, Agent %in% c(1,9)), aes(x = Round)) +
  geom_point(aes(y = Project1_Rewards/Project1_Work), size = .4) +
  geom_line(aes(y = Expectation1, color = as.character(Agent))) +
  facet_wrap(exp~thresh, ncol = 3) +
  theme_minimal() +
  labs(title = "Agent 1 & 9, Reward and Expectation for project 1", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round\nValues above plots: Upper = Eksponent, Lower = Threshold", y = "Reward - Expectation", color = "Agent")


ggplot(subset(e_t_data, Agent %in% c(1,9)), aes(x = Round)) +
  geom_point(aes(y = Project2_Rewards/Project2_Work), size = .4) +
  geom_line(aes(y = Expectation2, color = as.character(Agent))) +
  facet_wrap(exp~thresh, ncol = 3) +
  theme_minimal() +
  labs(title = "Agent 1 & 9, Reward and Expectation for project 2", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round\nValues above plots: Upper = Eksponent, Lower = Threshold", y = "Reward - Expectation", color = "Agent")


ggplot(subset(e_t_data, Agent %in% c(1,9)), aes(x = Round)) +
  geom_point(aes(y = Project3_Rewards/Project3_Work), size = .4) +
  geom_line(aes(y = Expectation3, color = as.character(Agent))) +
  facet_wrap(exp~thresh, ncol = 3) +
  theme_minimal() +
  labs(title = "Agent 1 & 9, Reward and Expectation for project 3", subtitle = "The lines represents the expectation for agent 1 and 9, the dots represents the actual reward each round\nValues above plots: Upper = Eksponent, Lower = Threshold", y = "Reward - Expectation", color = "Agent")

# total reward plot
ggplot(e_t_data, aes(y = Reward, x = Agent)) +
  stat_summary(fun.y = "sum", geom = "bar") + 
  facet_wrap(exp~thresh, ncol = 3) +
  theme_minimal() +
  labs(title = "Bar plot of the total sum of rewards per agent", subtitle = "Across 12 different simulations of 50 rounds each\nValues above plots: Upper = Eksponent, Lower = Threshold", y = "Sum of rewards")





### ALPHA PLOT ####
alphaPlotData = subset(alphaSim, Round == 50 & Agent == 18)
alphaPlotData$taskSum = alphaPlotData$Project1_Tasks + alphaPlotData$Project2_Tasks + alphaPlotData$Project3_Tasks
ggsave("plots/alphaPlot.jpg",
ggplot(alphaPlotData, aes(x = alpha, y = taskSum)) +
  geom_smooth() +
  theme_minimal()+
  scale_x_continuous(breaks=seq(0,1,.1)) +
  scale_y_continuous(breaks=seq(0,200,10)) 
)


```


REWARD FUNCTIONS SIMULATION
```{r}

work = 1:nAgents
rewards = c(rep(0,nAgents)) 
maxOpt = nAgents/nProjects # Maximum number of agents working a project in order to get the optimal (1) reward per agent

exp_data = data.frame()
for (e in c(0.3,0.4,0.5,0.6,0.7,0.8)){
  for (p in work){
    # if the number of agents working the project is less or equal to maxOpt, put this number on the total amount of reward for this project. Else, use the function to calculate it.
    if (work[p] <= maxOpt){ 
      rewards[p] = work[p] 
    } else {
      # Function for calculating total amount of rewards.
      # rewardExp is the exponent defined outside the simulation.
      # (work[p]-maxOpt+1) is just the number of agents above maxOpt + 1 (to make the exponent work from the first agent above maxOpt)
      # the minus 1 in the end is add to shift it down to the intercept
      rewards[p] = maxOpt + (work[p]-maxOpt+1)^e-1 
    }
  } 
  temp = data.frame("work" = work, "reward" = rewards, "exp" = e)
  exp_data = rbind(exp_data, temp)
}

ggplot(exp_data, aes(x = work, y = reward)) +
  geom_line() +
  theme_minimal() +
  facet_wrap(~exp) +
  xlim(0, 20) +
  ylim(0, 20) +
  labs(title = "Functions of how much total reward is given per project as the number of agents rise", subtitle = "The function is linear til 6 agents (18 (n agents) devided by 3 (n projects)) and exponential from there til 18. \nThe 6 plots show the function for different exponents", y = "Total reward", x = "Number of agents")



projects = rev(1:300)
nTasks = 300
rewards = c(rep(1,300))

thresh_data = data.frame()

for (t in c(0.2,0.3,0.4,0.5,0.6,0.7)){
for (p in 1:300){
 #if the number of tasks left is lower than a percentage (defined outside the simulation) of the max amount of tasks, then calculate a modifier and apply it to the total amount of rewards.
      if (projects[p] < nTasks*t){ 
        percentageLeft = projects[p] / nTasks # How much work is left 
        modifier = percentageLeft/t # percentage left since the threshold as a modifier
        rewards[p] = rewards[p] * modifier # Apply the modifier
      }
}
  temp = data.frame("reward" = rewards, "projects" = projects, "thresh" = t)
  thresh_data = rbind(thresh_data, temp)
}    

ggplot(thresh_data, aes(x = projects, y = reward)) +
  geom_line() +
  theme_minimal() +
  facet_wrap(~thresh) +
  labs(title = "How much a reward of 1 is decreased as a function of how many tasks are left in a project", subtitle = "A procentage threshold is defined. If the percentage of tasks left are below. \nThen the threshold a modifier is defined as the percentage left devided by the threshold. \nThen this modifier is multiplied by the threshold. \n6 plots showing different thresholds for a total amount of 300 tasks", y = "Reward", x = "Tasks left")

